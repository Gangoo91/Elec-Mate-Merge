/**
 * AM2 Rig Circuits
 *
 * All 7 circuits found on a standard AM2 practical assessment rig.
 * Nominal test values are realistic for a well-installed rig with
 * ~15m cable runs and Ze of 0.14Ω (typical TN-C-S supply).
 */

import type { AM2RigCircuit } from '@/types/am2-testing-simulator';

export const AM2_ZE = 0.14; // External earth fault loop impedance (TN-C-S)

export const AM2_RIG_CIRCUITS: AM2RigCircuit[] = [
  // ─── Circuit 1: Ring Final (Socket Outlets) ───
  {
    id: 1,
    name: 'Ring Final',
    description: '32A ring final circuit — socket outlets',
    mcbRating: 32,
    mcbType: 'B',
    breakingCapacity: 6,
    bsStandard: 'BS EN 60898',
    cableType: '2.5mm² T&E',
    liveMm2: '2.5',
    cpcMm2: '1.5',
    wiringType: 'A',
    referenceMethod: 'C',
    maxZs: 1.37,
    pointsServed: '6',
    hasRcd: false,
    phaseType: '1P',
    diagramLayout: 'ring',
    testPoints: [
      {
        id: 'c1-db',
        label: 'Distribution Board',
        type: 'db',
        availableTests: ['CONTINUITY', 'IR_500V', 'LOOP_ZS', 'PFC'],
        xPct: 50,
        yPct: 15,
      },
      {
        id: 'c1-s1',
        label: 'Socket 1',
        type: 'socket',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 85,
        yPct: 40,
      },
      {
        id: 'c1-s2',
        label: 'Socket 2',
        type: 'socket',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 85,
        yPct: 70,
      },
      {
        id: 'c1-s3',
        label: 'Socket 3',
        type: 'socket',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 50,
        yPct: 85,
      },
      {
        id: 'c1-s4',
        label: 'Socket 4',
        type: 'socket',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 15,
        yPct: 70,
      },
      {
        id: 'c1-s5',
        label: 'Socket 5',
        type: 'socket',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 15,
        yPct: 40,
      },
    ],
    nominalValues: {
      ringR1: 0.52,
      ringRn: 0.52,
      ringR2: 0.87,
      r1r2: 0.35,
      r2: 0.22,
      irBase: 250,
      zs: 0.72,
      ze: AM2_ZE,
      pfc: 1.84,
    },
    requiredTests: [
      {
        id: 'c1-cont-r1',
        testPointId: 'c1-db',
        dialPosition: 'CONTINUITY',
        subTest: 'r1',
        gn3Step: 2,
        description: 'Ring r₁ (line) end-to-end',
      },
      {
        id: 'c1-cont-rn',
        testPointId: 'c1-db',
        dialPosition: 'CONTINUITY',
        subTest: 'rn',
        gn3Step: 2,
        description: 'Ring rₙ (neutral) end-to-end',
      },
      {
        id: 'c1-cont-r2',
        testPointId: 'c1-db',
        dialPosition: 'CONTINUITY',
        subTest: 'r2',
        gn3Step: 2,
        description: 'Ring r₂ (cpc) end-to-end',
      },
      {
        id: 'c1-cont-r1r2',
        testPointId: 'c1-s3',
        dialPosition: 'CONTINUITY',
        subTest: 'r1r2',
        gn3Step: 2,
        description: 'Cross-connected R₁+R₂ at mid-point',
      },
      {
        id: 'c1-ir',
        testPointId: 'c1-db',
        dialPosition: 'IR_500V',
        subTest: 'L-E',
        gn3Step: 3,
        description: 'Insulation resistance L-E',
      },
      {
        id: 'c1-ir-ll',
        testPointId: 'c1-db',
        dialPosition: 'IR_500V',
        subTest: 'L-L',
        gn3Step: 3,
        description: 'Insulation resistance L-L',
      },
      {
        id: 'c1-zs',
        testPointId: 'c1-s3',
        dialPosition: 'LOOP_ZS',
        gn3Step: 6,
        description: 'Zs at furthest point',
      },
      {
        id: 'c1-pfc',
        testPointId: 'c1-db',
        dialPosition: 'PFC',
        gn3Step: 8,
        description: 'Prospective fault current at DB',
      },
    ],
  },

  // ─── Circuit 2: Radial (Cooker) ───
  {
    id: 2,
    name: 'Radial (Cooker)',
    description: '32A radial circuit — cooker control unit',
    mcbRating: 32,
    mcbType: 'B',
    breakingCapacity: 6,
    bsStandard: 'BS EN 60898',
    cableType: '4mm² T&E',
    liveMm2: '4',
    cpcMm2: '2.5',
    wiringType: 'A',
    referenceMethod: 'C',
    maxZs: 1.37,
    pointsServed: '1',
    hasRcd: false,
    phaseType: '1P',
    diagramLayout: 'linear',
    testPoints: [
      {
        id: 'c2-db',
        label: 'Distribution Board',
        type: 'db',
        availableTests: ['CONTINUITY', 'IR_500V', 'PFC'],
        xPct: 15,
        yPct: 50,
      },
      {
        id: 'c2-cooker',
        label: 'Cooker Unit',
        type: 'cooker',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 85,
        yPct: 50,
      },
    ],
    nominalValues: {
      r1r2: 0.28,
      r2: 0.17,
      irBase: 300,
      zs: 0.42,
      ze: AM2_ZE,
      pfc: 1.84,
    },
    requiredTests: [
      {
        id: 'c2-cont',
        testPointId: 'c2-cooker',
        dialPosition: 'CONTINUITY',
        subTest: 'r1r2',
        gn3Step: 1,
        description: 'R₁+R₂ at cooker unit',
      },
      {
        id: 'c2-ir',
        testPointId: 'c2-db',
        dialPosition: 'IR_500V',
        subTest: 'L-E',
        gn3Step: 3,
        description: 'Insulation resistance L-E',
      },
      {
        id: 'c2-ir-ll',
        testPointId: 'c2-db',
        dialPosition: 'IR_500V',
        subTest: 'L-L',
        gn3Step: 3,
        description: 'Insulation resistance L-L',
      },
      {
        id: 'c2-zs',
        testPointId: 'c2-cooker',
        dialPosition: 'LOOP_ZS',
        gn3Step: 6,
        description: 'Zs at cooker unit',
      },
      {
        id: 'c2-pfc',
        testPointId: 'c2-db',
        dialPosition: 'PFC',
        gn3Step: 8,
        description: 'Prospective fault current',
      },
    ],
  },

  // ─── Circuit 3: Lighting (2-Way Switching) ───
  {
    id: 3,
    name: 'Lighting (2-Way)',
    description: '6A lighting circuit with 2-way switching',
    mcbRating: 6,
    mcbType: 'B',
    breakingCapacity: 6,
    bsStandard: 'BS EN 60898',
    cableType: '1.5mm² T&E',
    liveMm2: '1.5',
    cpcMm2: '1.0',
    wiringType: 'A',
    referenceMethod: 'C',
    maxZs: 7.67,
    pointsServed: '2',
    hasRcd: false,
    phaseType: '1P',
    diagramLayout: 'linear',
    testPoints: [
      {
        id: 'c3-db',
        label: 'Distribution Board',
        type: 'db',
        availableTests: ['CONTINUITY', 'IR_500V'],
        xPct: 10,
        yPct: 50,
      },
      {
        id: 'c3-sw1',
        label: '2-Way Switch 1',
        type: 'switch',
        availableTests: ['CONTINUITY'],
        xPct: 35,
        yPct: 50,
      },
      {
        id: 'c3-light',
        label: 'Ceiling Rose',
        type: 'light',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 60,
        yPct: 50,
      },
      {
        id: 'c3-sw2',
        label: '2-Way Switch 2',
        type: 'switch',
        availableTests: ['CONTINUITY'],
        xPct: 90,
        yPct: 50,
      },
    ],
    nominalValues: {
      r1r2: 1.2,
      r2: 0.78,
      irBase: 280,
      zs: 1.34,
      ze: AM2_ZE,
      pfc: 1.84,
    },
    requiredTests: [
      {
        id: 'c3-cont',
        testPointId: 'c3-light',
        dialPosition: 'CONTINUITY',
        subTest: 'r1r2',
        gn3Step: 1,
        description: 'R₁+R₂ at light fitting',
      },
      {
        id: 'c3-polarity',
        testPointId: 'c3-light',
        dialPosition: 'CONTINUITY',
        subTest: 'polarity',
        gn3Step: 4,
        description: 'Polarity check at light',
      },
      {
        id: 'c3-ir',
        testPointId: 'c3-db',
        dialPosition: 'IR_500V',
        subTest: 'L-E',
        gn3Step: 3,
        description: 'Insulation resistance L-E',
      },
      {
        id: 'c3-ir-ll',
        testPointId: 'c3-db',
        dialPosition: 'IR_500V',
        subTest: 'L-L',
        gn3Step: 3,
        description: 'Insulation resistance L-L',
      },
      {
        id: 'c3-zs',
        testPointId: 'c3-light',
        dialPosition: 'LOOP_ZS',
        gn3Step: 6,
        description: 'Zs at light fitting',
      },
    ],
  },

  // ─── Circuit 4: 3-Phase Motor (DOL) ───
  {
    id: 4,
    name: '3-Phase Motor (DOL)',
    description: '20A 3-phase motor with direct-on-line starter',
    mcbRating: 20,
    mcbType: 'C',
    breakingCapacity: 10,
    bsStandard: 'BS EN 60898',
    cableType: '2.5mm² SWA',
    liveMm2: '2.5',
    cpcMm2: '1.5',
    wiringType: 'F',
    referenceMethod: 'F',
    maxZs: 1.09,
    pointsServed: '1',
    hasRcd: false,
    phaseType: '3P',
    diagramLayout: 'linear',
    testPoints: [
      {
        id: 'c4-db',
        label: 'Distribution Board',
        type: 'db',
        availableTests: ['CONTINUITY', 'IR_500V'],
        xPct: 10,
        yPct: 50,
      },
      {
        id: 'c4-iso',
        label: 'TPN Isolator',
        type: 'isolator',
        availableTests: ['CONTINUITY'],
        xPct: 30,
        yPct: 50,
      },
      {
        id: 'c4-dol',
        label: 'DOL Starter',
        type: 'dol_starter',
        availableTests: ['CONTINUITY'],
        xPct: 55,
        yPct: 50,
      },
      {
        id: 'c4-motor',
        label: 'Motor Terminal Box',
        type: 'motor',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 85,
        yPct: 50,
      },
    ],
    nominalValues: {
      r1r2: 0.35,
      r2: 0.22,
      irBase: 250,
      zs: 0.49,
      ze: AM2_ZE,
      pfc: 1.84,
    },
    requiredTests: [
      {
        id: 'c4-cont',
        testPointId: 'c4-motor',
        dialPosition: 'CONTINUITY',
        subTest: 'r1r2',
        gn3Step: 1,
        description: 'R₁+R₂ at motor terminals',
      },
      {
        id: 'c4-ir',
        testPointId: 'c4-db',
        dialPosition: 'IR_500V',
        subTest: 'L-E',
        gn3Step: 3,
        description: 'Insulation resistance L-E',
      },
      {
        id: 'c4-ir-ll',
        testPointId: 'c4-db',
        dialPosition: 'IR_500V',
        subTest: 'L-L',
        gn3Step: 3,
        description: 'Insulation resistance L-L',
      },
      {
        id: 'c4-zs',
        testPointId: 'c4-motor',
        dialPosition: 'LOOP_ZS',
        gn3Step: 6,
        description: 'Zs at motor terminals',
      },
    ],
  },

  // ─── Circuit 5: Fire Alarm ───
  {
    id: 5,
    name: 'Fire Alarm',
    description: '6A fire alarm circuit — FP200 cable',
    mcbRating: 6,
    mcbType: 'B',
    breakingCapacity: 6,
    bsStandard: 'BS EN 60898',
    cableType: '1.5mm² FP200',
    liveMm2: '1.5',
    cpcMm2: '1.0',
    wiringType: 'C',
    referenceMethod: 'C',
    maxZs: 7.67,
    pointsServed: '4',
    hasRcd: false,
    phaseType: '1P',
    diagramLayout: 'linear',
    testPoints: [
      {
        id: 'c5-db',
        label: 'Distribution Board',
        type: 'db',
        availableTests: ['CONTINUITY', 'IR_500V'],
        xPct: 10,
        yPct: 50,
      },
      {
        id: 'c5-panel',
        label: 'Fire Alarm Panel',
        type: 'fire_panel',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 40,
        yPct: 50,
      },
      {
        id: 'c5-det1',
        label: 'Detector 1',
        type: 'detector',
        availableTests: ['CONTINUITY'],
        xPct: 65,
        yPct: 50,
      },
      {
        id: 'c5-det2',
        label: 'Detector 2',
        type: 'detector',
        availableTests: ['CONTINUITY'],
        xPct: 90,
        yPct: 50,
      },
    ],
    nominalValues: {
      r1r2: 1.2,
      r2: 0.78,
      irBase: 280,
      zs: 1.34,
      ze: AM2_ZE,
      pfc: 1.84,
    },
    requiredTests: [
      {
        id: 'c5-cont',
        testPointId: 'c5-panel',
        dialPosition: 'CONTINUITY',
        subTest: 'r1r2',
        gn3Step: 1,
        description: 'R₁+R₂ at fire alarm panel',
      },
      {
        id: 'c5-ir',
        testPointId: 'c5-db',
        dialPosition: 'IR_500V',
        subTest: 'L-E',
        gn3Step: 3,
        description: 'Insulation resistance L-E',
      },
      {
        id: 'c5-ir-ll',
        testPointId: 'c5-db',
        dialPosition: 'IR_500V',
        subTest: 'L-L',
        gn3Step: 3,
        description: 'Insulation resistance L-L',
      },
      {
        id: 'c5-zs',
        testPointId: 'c5-panel',
        dialPosition: 'LOOP_ZS',
        gn3Step: 6,
        description: 'Zs at fire alarm panel',
      },
    ],
  },

  // ─── Circuit 6: Data (Cat 6) ───
  {
    id: 6,
    name: 'Data (Cat 6)',
    description: '6A data circuit — Cat 6 with dedicated supply',
    mcbRating: 6,
    mcbType: 'B',
    breakingCapacity: 6,
    bsStandard: 'BS EN 60898',
    cableType: 'Cat 6 / 1.5mm²',
    liveMm2: '1.5',
    cpcMm2: '1.0',
    wiringType: 'A',
    referenceMethod: 'B',
    maxZs: 7.67,
    pointsServed: '4',
    hasRcd: false,
    phaseType: '1P',
    diagramLayout: 'linear',
    testPoints: [
      {
        id: 'c6-db',
        label: 'Distribution Board',
        type: 'db',
        availableTests: ['CONTINUITY', 'IR_500V'],
        xPct: 15,
        yPct: 50,
      },
      {
        id: 'c6-patch',
        label: 'Patch Panel',
        type: 'patch_panel',
        availableTests: ['CONTINUITY'],
        xPct: 50,
        yPct: 50,
      },
      {
        id: 'c6-data',
        label: 'Data Outlet',
        type: 'data_outlet',
        availableTests: ['CONTINUITY'],
        xPct: 85,
        yPct: 50,
      },
    ],
    nominalValues: {
      r1r2: 1.2,
      r2: 0.78,
      irBase: 300,
      zs: 1.34,
      ze: AM2_ZE,
      pfc: 1.84,
    },
    requiredTests: [
      {
        id: 'c6-cont',
        testPointId: 'c6-data',
        dialPosition: 'CONTINUITY',
        subTest: 'r1r2',
        gn3Step: 1,
        description: 'Continuity at data outlet',
      },
      {
        id: 'c6-ir',
        testPointId: 'c6-db',
        dialPosition: 'IR_500V',
        subTest: 'L-E',
        gn3Step: 3,
        description: 'Insulation resistance L-E',
      },
      {
        id: 'c6-ir-ll',
        testPointId: 'c6-db',
        dialPosition: 'IR_500V',
        subTest: 'L-L',
        gn3Step: 3,
        description: 'Insulation resistance L-L',
      },
    ],
  },

  // ─── Circuit 7: Shower (RCD Protected) ───
  {
    id: 7,
    name: 'Shower',
    description: '40A shower circuit — 30mA RCD protected',
    mcbRating: 40,
    mcbType: 'B',
    breakingCapacity: 6,
    bsStandard: 'BS EN 60898',
    cableType: '6mm² T&E',
    liveMm2: '6',
    cpcMm2: '2.5',
    wiringType: 'A',
    referenceMethod: 'C',
    maxZs: 1.04,
    pointsServed: '1',
    hasRcd: true,
    rcdRating: 30,
    rcdType: 'Type A',
    rcdBsStandard: 'BS EN 61008',
    phaseType: '1P',
    diagramLayout: 'linear',
    testPoints: [
      {
        id: 'c7-db',
        label: 'Distribution Board',
        type: 'db',
        availableTests: ['CONTINUITY', 'IR_500V', 'RCD_30', 'PFC'],
        xPct: 15,
        yPct: 50,
      },
      {
        id: 'c7-shower',
        label: 'Shower Unit',
        type: 'shower',
        availableTests: ['CONTINUITY', 'LOOP_ZS'],
        xPct: 85,
        yPct: 50,
      },
    ],
    nominalValues: {
      r1r2: 0.17,
      r2: 0.1,
      irBase: 300,
      zs: 0.31,
      ze: AM2_ZE,
      rcdTripTime: 22,
      pfc: 1.84,
    },
    requiredTests: [
      {
        id: 'c7-cont',
        testPointId: 'c7-shower',
        dialPosition: 'CONTINUITY',
        subTest: 'r1r2',
        gn3Step: 1,
        description: 'R₁+R₂ at shower unit',
      },
      {
        id: 'c7-ir',
        testPointId: 'c7-db',
        dialPosition: 'IR_500V',
        subTest: 'L-E',
        gn3Step: 3,
        description: 'Insulation resistance L-E',
      },
      {
        id: 'c7-ir-ll',
        testPointId: 'c7-db',
        dialPosition: 'IR_500V',
        subTest: 'L-L',
        gn3Step: 3,
        description: 'Insulation resistance L-L',
      },
      {
        id: 'c7-zs',
        testPointId: 'c7-shower',
        dialPosition: 'LOOP_ZS',
        gn3Step: 6,
        description: 'Zs at shower unit',
      },
      {
        id: 'c7-rcd',
        testPointId: 'c7-db',
        dialPosition: 'RCD_30',
        gn3Step: 7,
        description: 'RCD trip test at 1× (30mA)',
      },
      {
        id: 'c7-rcd-btn',
        testPointId: 'c7-db',
        dialPosition: 'RCD_30',
        subTest: 'test_button',
        gn3Step: 7,
        description: 'RCD test button operation',
      },
      {
        id: 'c7-pfc',
        testPointId: 'c7-db',
        dialPosition: 'PFC',
        gn3Step: 8,
        description: 'Prospective fault current',
      },
    ],
  },
];

/** Get a circuit by ID */
export function getAM2Circuit(id: number): AM2RigCircuit | undefined {
  return AM2_RIG_CIRCUITS.find((c) => c.id === id);
}
